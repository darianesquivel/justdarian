---
import ChristmasCountdown from "./ChristmasCountdown.astro";
---

<header
  id="main-header"
  class="w-full flex flex-col gap-3 justify-center items-center fixed z-50 transition-transform duration-300 ease-out
         bg-gradient-to-b from-primary/95 to-transparent backdrop-blur-xs rounded-b-xl"
>
<div>
  <ChristmasCountdown/> 
</div>
  <div
    class="flex w-full max-w-6xl justify-between items-center text-white py-4 px-6"
  >
    <div class="flex gap-5 justify-center items-center">
      <a
        href="/"
        aria-label="Ir al inicio"
        class="text-lg md:text-2xl font-extrabold"
      >
        <img src="/logo.png" class="w-32" alt="" />
      </a>
      <!-- <img src="/cybermonday.svg" class="w-12" alt="" /> CYBERMONDAY -->
    </div>

    <nav
      class="hidden md:flex gap-6 lg:gap-10 font-extrabold items-center text-xs md:text-sm"
    >
      <a
        href="#hero"
        class="transition-transform duration-300 hover:scale-110 uppercase"
        >Inicio</a
      >
      <a
        href="#services"
        class="transition-transform duration-300 hover:scale-110 uppercase"
        >Servicios</a
      >
      <a
        href="#why-me"
        class="transition-transform duration-300 hover:scale-110 uppercase"
        >Por que yo?</a
      >
      <a
        href="#pricing"
        class="transition-transform duration-300 hover:scale-110 uppercase"
        >Precios</a
      >
      <a
        href="#contact"
        class="transition-transform duration-300 hover:scale-110 border-2 border-secondary text-secondary font-extrabold rounded-full px-4 py-1 uppercase"
        >Contacto</a
      >
    </nav>

    <div class="relative md:hidden">
      <button
        id="menu-btn"
        aria-expanded="false"
        aria-controls="mobile-menu"
        aria-label="Abrir menÃº"
        class="p-2 flex flex-col gap-1.5 items-end focus:outline-none focus:ring-2 focus:ring-white rounded"
        type="button"
      >
        <span class="w-6 h-0.5 bg-white rounded"></span>
        <span class="w-4 h-0.5 bg-white rounded"></span>
        <span class="w-5 h-0.5 bg-white rounded"></span>
      </button>

      <div
        id="mobile-menu"
        class="absolute right-0 mt-2 w-44 rounded-b-xl bg-primary/95 text-white font-bold
               flex flex-col divide-y divide-white/10 overflow-hidden
               max-h-0 opacity-0 pointer-events-none transition-all duration-300"
        role="menu"
        aria-hidden="true"
      >
        <a
          href="#hero"
          class="block w-full text-left px-4 py-3 hover:bg-primary/80 uppercase"
          role="menuitem"
          tabindex="-1">Inicio</a
        >
        <a
          href="#services"
          class="block w-full text-left px-4 py-3 hover:bg-primary/80 uppercase"
          role="menuitem"
          tabindex="-1">Servicios</a
        >
        <a
          href="#why-me"
          class="block w-full text-left px-4 py-3 hover:bg-primary/80 uppercase"
          role="menuitem"
          tabindex="-1">Por que yo?</a
        >
        <a
          href="#pricing"
          class="block w-full text-left px-4 py-3 hover:bg-primary/80 uppercase"
          role="menuitem"
          tabindex="-1">Precios</a
        >
        <a
          href="#contact"
          class="block w-full text-left px-4 py-3 hover:bg-primary/80 uppercase"
          role="menuitem"
          tabindex="-1">Contacto</a
        >
      </div>
    </div>
  </div>
</header>

<script>
  const menuBtn = document.getElementById("menu-btn");
  const mobileMenu = document.getElementById("mobile-menu");
  const wrapper = menuBtn?.parentElement;

  const openClasses = ["max-h-[240px]", "opacity-100", "pointer-events-auto"];
  const closeClasses = ["max-h-0", "opacity-0", "pointer-events-none"];

  function openMenu() {
    mobileMenu?.classList.remove(...closeClasses);
    mobileMenu?.classList.add(...openClasses);
    mobileMenu?.setAttribute("aria-hidden", "false");
    menuBtn?.setAttribute("aria-expanded", "true");
    mobileMenu?.querySelectorAll("a").forEach((a) => {
      a.removeAttribute("tabindex");
    });
  }

  function closeMenu() {
    mobileMenu?.classList.remove(...openClasses);
    mobileMenu?.classList.add(...closeClasses);
    mobileMenu?.setAttribute("aria-hidden", "true");
    menuBtn?.setAttribute("aria-expanded", "false");
    mobileMenu?.querySelectorAll("a").forEach((a) => {
      a.setAttribute("tabindex", "-1");
    });
  }

  menuBtn?.addEventListener("click", (e) => {
    e.stopPropagation();
    const isOpen = mobileMenu?.classList.contains("max-h-[240px]");
    if (isOpen) closeMenu();
    else openMenu();
  });

  document.addEventListener("click", (e) => {
    if (e.target instanceof Node && !wrapper?.contains(e.target)) closeMenu();
  });

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") closeMenu();
  });

  mobileMenu?.querySelectorAll("a").forEach((a) => {
    a.addEventListener("click", () => closeMenu());
  });

  const header = document.getElementById("main-header");
  const mobileBreakpoint = 768;

  if (header && window.innerWidth >= mobileBreakpoint) {
    const headerHeight = header.offsetHeight;
    let lastScrollY = window.scrollY;
    const scrollThreshold = 100;

    function handleScroll(e: Event) {
      if (!header) return;

      if (window.scrollY <= scrollThreshold) {
        header.style.transform = "translateY(0)";
        lastScrollY = window.scrollY;
        return;
      }

      if (window.scrollY > lastScrollY && window.scrollY > headerHeight) {
        header.style.transform = `translateY(-${headerHeight}px)`;
      } else if (window.scrollY < lastScrollY) {
        header.style.transform = "translateY(0)";
      }

      lastScrollY = window.scrollY;
    }

    function handleMouseMove(e: MouseEvent) {
      if (!header) return;
      const isHidden = header.style.transform.includes("-");

      if (isHidden && e.clientY < 20) {
        header.style.transform = "translateY(0)";
      }
    }

    window.addEventListener("scroll", handleScroll);
    document.addEventListener("mousemove", handleMouseMove);
  }
</script>
