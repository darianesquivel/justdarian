---
const numberOfFlakes = 100;
const flakes = Array.from({ length: numberOfFlakes }).map((_, index) => {
  const layer = Math.floor(Math.random() * 3) + 1;

  const sizeMultiplier = layer * 0.4;
  const speedMultiplier = 1 / layer;

  const duration = (Math.random() * 10 + 15) * speedMultiplier;
  const delay = Math.random() * -30;
  const size = (Math.random() * 2 + 2) * sizeMultiplier;
  const xPos = Math.random() * 100;
  const windOffset = (Math.random() * 20 - 10) * speedMultiplier;
  const windDirection = windOffset > 0 ? 1 : -1;
  
  const mobileHideClass = index % 5 !== 0 ? 'mobile-hide' : '';

  return {
    class: `snowflake ${mobileHideClass}`,
    style: `--flake-size: ${size}px; 
            --flake-x-pos: ${xPos}%; 
            --flake-duration: ${duration}s; 
            --flake-delay: ${delay}s;
            --flake-wind-offset: ${Math.abs(windOffset)}vw; 
            --flake-wind-direction: ${windDirection};
            --flake-opacity: ${0.3 + layer * 0.2};
            z-index: ${layer * 10};`,
  };
});
---

<div class="snow-container">
  {flakes.map((flake) => <div class={flake.class} style={flake.style} />)}
</div>

<style is:global is:inline>
  .snow-container {
    pointer-events: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    z-index: 9999;
  }

  .snowflake {
    position: absolute;
    background-color: white;
    border-radius: 50%;
    opacity: var(--flake-opacity);

    width: var(--flake-size);
    height: var(--flake-size);
    left: var(--flake-x-pos);
    z-index: var(z-index);

    will-change: transform;

    animation-name: fall;
    animation-duration: var(--flake-duration);
    animation-timing-function: linear;
    animation-iteration-count: infinite;
    animation-delay: var(--flake-delay);
  }

  @keyframes fall {
    0% {
      transform: translate(0, -10vh);
    }
    50% {
      transform: translate(
        calc(var(--flake-wind-offset) * var(--flake-wind-direction)),
        50vh
      );
    }
    100% {
      transform: translate(0, 110vh);
    }
  }

  @media (max-width: 768px) {
    .mobile-hide {
      display: none !important;
    }
  }
</style>